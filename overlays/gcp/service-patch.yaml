# ============================================================================
# Service Patches - GCE Ingress용 NodePort + BackendConfig + NEG
# ============================================================================
# NEG annotation으로 GKE가 자동으로 NEG 생성 및 엔드포인트 관리
# 외부 LB (psj0514-static-lb) 사용 시 클러스터 재생성 후 NEG 재연결 필요
# ============================================================================
apiVersion: v1
kind: Service
metadata:
  name: api-gateway
  namespace: petclinic
  annotations:
    cloud.google.com/backend-config: '{"default": "api-gateway-backend-config"}'
    # NEG 자동 생성 - 클러스터 재생성 시 새 NEG 생성되므로 백엔드 서비스 재연결 필요
    cloud.google.com/neg: '{"ingress": true}'
spec:
  type: NodePort
---
apiVersion: v1
kind: Service
metadata:
  name: admin-server
  namespace: petclinic
  annotations:
    cloud.google.com/backend-config: '{"default": "admin-server-backend-config"}'
    # NEG 자동 생성
    cloud.google.com/neg: '{"ingress": true}'
spec:
  type: NodePort
---
apiVersion: v1
kind: Service
metadata:
  name: grafana-server
  namespace: petclinic
  annotations:
    cloud.google.com/backend-config: '{"default": "grafana-backend-config"}'
spec:
  type: NodePort
---
apiVersion: v1
kind: Service
metadata:
  name: prometheus-server
  namespace: petclinic
  annotations:
    cloud.google.com/backend-config: '{"default": "prometheus-backend-config"}'
spec:
  type: NodePort
